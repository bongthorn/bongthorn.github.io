(window.webpackJsonp=window.webpackJsonp||[]).push([[99],{153:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return i})),r.d(t,"metadata",(function(){return a})),r.d(t,"rightToc",(function(){return n})),r.d(t,"default",(function(){return l}));var s=r(2),o=(r(0),r(211));const i={title:"Step23 Firestore security rules"},a={unversionedId:"flutter-crud2a/firestore-security-rules",id:"flutter-crud2a/firestore-security-rules",isDocsHomePage:!1,title:"Step23 Firestore security rules",description:"Goal of this step",source:"@site/docs/flutter-crud2a/firestore-security-rules.md",permalink:"/docs/flutter-crud2a/firestore-security-rules",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/flutter-crud2a/firestore-security-rules.md",sidebar:"flutterCrud2a",previous:{title:"Step22 Edit Post Page",permalink:"/docs/flutter-crud2a/edit-post-page"},next:{title:"Step24 Firestore Security Rules Testing",permalink:"/docs/flutter-crud2a/firestore-security-rules-test"}},n=[{value:"Goal of this step",id:"goal-of-this-step",children:[]},{value:"Overview",id:"overview",children:[]},{value:"Get started",id:"get-started",children:[{value:"Writing rules",id:"writing-rules",children:[]},{value:"Testing rules",id:"testing-rules",children:[]},{value:"Deploying rules",id:"deploying-rules",children:[]}]},{value:"Security Rules Basic",id:"security-rules-basic",children:[{value:"Basic read/write rules",id:"basic-readwrite-rules",children:[]},{value:"Granular operations",id:"granular-operations",children:[]},{value:"Hierarchical data",id:"hierarchical-data",children:[]}]},{value:"Rules for our Flutter application",id:"rules-for-our-flutter-application",children:[]},{value:"Real world posts &quot;read&quot; security rules",id:"real-world-posts-read-security-rules",children:[]},{value:"Refs and Memo Links",id:"refs-and-memo-links",children:[]}],c={rightToc:n};function l({components:e,...t}){return Object(o.b)("wrapper",Object(s.a)({},c,t,{components:e,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"goal-of-this-step"},"Goal of this step"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Learn how to write Firestore security rules.")),Object(o.b)("h2",{id:"overview"},"Overview"),Object(o.b)("p",null,Object(o.b)("a",Object(s.a)({parentName:"p"},{href:"https://firebase.google.com/docs/firestore/security/overview"}),"https://firebase.google.com/docs/firestore/security/overview")),Object(o.b)("p",null,'=> Flutter is "',Object(o.b)("strong",{parentName:"p"},"mobile"),'" app so, we are using ',Object(o.b)("strong",{parentName:"p"},'"Firestore Security Rules"'),"."),Object(o.b)("h2",{id:"get-started"},"Get started"),Object(o.b)("p",null,'In this section, let\'s check "Get Started" Page.'),Object(o.b)("p",null,Object(o.b)("a",Object(s.a)({parentName:"p"},{href:"https://firebase.google.com/docs/firestore/security/get-started"}),"https://firebase.google.com/docs/firestore/security/get-started")),Object(o.b)("h3",{id:"writing-rules"},"Writing rules"),Object(o.b)("p",null,Object(o.b)("a",Object(s.a)({parentName:"p"},{href:"https://firebase.google.com/docs/firestore/security/get-started#writing_rules"}),"https://firebase.google.com/docs/firestore/security/get-started#writing_rules")),Object(o.b)("h3",{id:"testing-rules"},"Testing rules"),Object(o.b)("p",null,Object(o.b)("a",Object(s.a)({parentName:"p"},{href:"https://firebase.google.com/docs/firestore/security/get-started#testing_rules"}),"https://firebase.google.com/docs/firestore/security/get-started#testing_rules")),Object(o.b)("h3",{id:"deploying-rules"},"Deploying rules"),Object(o.b)("p",null,Object(o.b)("a",Object(s.a)({parentName:"p"},{href:"https://firebase.google.com/docs/firestore/security/get-started#deploying_rules"}),"https://firebase.google.com/docs/firestore/security/get-started#deploying_rules")),Object(o.b)("h2",{id:"security-rules-basic"},"Security Rules Basic"),Object(o.b)("p",null,"In this section, let's take a look at how to write basic security rules."),Object(o.b)("h3",{id:"basic-readwrite-rules"},"Basic read/write rules"),Object(o.b)("p",null,Object(o.b)("a",Object(s.a)({parentName:"p"},{href:"https://firebase.google.com/docs/firestore/security/rules-structure#basic_readwrite_rules"}),"https://firebase.google.com/docs/firestore/security/rules-structure#basic_readwrite_rules")),Object(o.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(o.b)("div",Object(s.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(s.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(s.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(o.b)("path",Object(s.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),Object(o.b)("strong",{parentName:"h5"},"*NOTE!"))),Object(o.b)("div",Object(s.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"You ",Object(o.b)("strong",{parentName:"p"},"cannot")," write rules like rest api(below)."),Object(o.b)("pre",{parentName:"div"},Object(o.b)("code",Object(s.a)({parentName:"pre"},{className:"language-js"}),"match /cities {\n  allow list: if <condition>;\n}\n")))),Object(o.b)("h3",{id:"granular-operations"},"Granular operations"),Object(o.b)("p",null,Object(o.b)("a",Object(s.a)({parentName:"p"},{href:"https://firebase.google.com/docs/firestore/security/rules-structure#granular_operations"}),"https://firebase.google.com/docs/firestore/security/rules-structure#granular_operations")),Object(o.b)("h3",{id:"hierarchical-data"},"Hierarchical data"),Object(o.b)("p",null,Object(o.b)("a",Object(s.a)({parentName:"p"},{href:"https://firebase.google.com/docs/firestore/security/rules-structure#hierarchical_data"}),"https://firebase.google.com/docs/firestore/security/rules-structure#hierarchical_data")),Object(o.b)("h2",{id:"rules-for-our-flutter-application"},"Rules for our Flutter application"),Object(o.b)("pre",null,Object(o.b)("code",Object(s.a)({parentName:"pre"},{className:"language-js"}),'rules_version = \'2\';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    /* Anyone can read post */\n    // We use "collectionGroup()" to query posts, so you need to be a little bit careful.\n    // https://firebase.google.com/docs/firestore/security/rules-query#collection_group_queries_and_security_rules\n    match /{path=**}/posts/{post} {\n      allow read: if true;\n    }\n\n    match /users/{userId} {\n      // https://firebase.google.com/docs/firestore/security/rules-conditions#authentication\n      /* User can be created only if they are authenticated. */\n      allow create: if request.auth.uid != null;\n\n      // A "read" rule can be divided into "get" and "list" rules\n      // https://firebase.google.com/docs/firestore/security/rules-structure#granular_operations\n      // And this is Hierarchical data rules.\n      // https://firebase.google.com/docs/firestore/security/rules-structure#hierarchical_data\n      // *NOTE!: This rule is no meaning because of subcollection post rule.\n      match /posts/{post} {\n        // Applies to single document read requests\n        /* We dont\' request this from Flutter App. Just a example */\n        allow get: if request.auth.uid == userId;\n\n        // Applies to queries and collection read requests\n        allow list: if request.auth.uid == userId;\n      }\n\n\n      // A "write" rule can be divided into "create", "update", and "delete" rules\n      // https://firebase.google.com/docs/firestore/security/rules-structure#granular_operations\n      match /posts/{post} {\n        // To create post, user must login,\n        // Title required\n        // https://firebase.google.com/docs/firestore/security/rules-conditions#data_validation\n        // ""(empty string) is not null. So we need to write like this.\n        // https://firebase.google.com/docs/reference/rules/rules.String?authuser=0#size\n        allow create: if request.auth.uid != null\n                      && request.resource.data.title.size() > 0;\n\n        // Applies to writes to existing documents\n        // User must be author && title requied to update.\n        allow update: if request.auth.uid == userId\n                      && request.resource.data.title.size() > 0;\n\n        // Applies to delete operations\n        allow delete: if request.auth.uid == userId;\n      }\n    }\n  }\n}\n')),Object(o.b)("h2",{id:"real-world-posts-read-security-rules"},'Real world posts "read" security rules'),Object(o.b)("p",null,"Let's fix meaningless collectionGroup posts rules."),Object(o.b)("pre",null,Object(o.b)("code",Object(s.a)({parentName:"pre"},{className:"language-js",metastring:"{9}","{9}":!0}),"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    /* Anyone can read post published post */\n    // We use \"collectionGroup()\" to query posts, so you need to be a little bit careful.\n    // https://firebase.google.com/docs/firestore/security/rules-query#collection_group_queries_and_security_rules\n    match /{path=**}/posts/{post} {\n      allow read: if resource.data.published == true;\n    }\n  ...\n}\n")),Object(o.b)("p",null,"*This is just a demo for security rules."),Object(o.b)("p",null,"We are not going to implement publish and draft feature in Flutter side."),Object(o.b)("h2",{id:"refs-and-memo-links"},"Refs and Memo Links"),Object(o.b)("p",null,Object(o.b)("a",Object(s.a)({parentName:"p"},{href:"https://firebase.google.com/docs/firestore/security/rules-query#secure_collection_group_queries_based_on_a_fiel"}),"https://firebase.google.com/docs/firestore/security/rules-query#secure_collection_group_queries_based_on_a_fiel")),Object(o.b)("p",null,Object(o.b)("a",Object(s.a)({parentName:"p"},{href:"https://stackoverflow.com/questions/56149601/firestore-collection-group-query-on-documentid"}),"https://stackoverflow.com/questions/56149601/firestore-collection-group-query-on-documentid")),Object(o.b)("p",null,Object(o.b)("a",Object(s.a)({parentName:"p"},{href:"https://stackoverflow.com/questions/56219469/firestore-get-the-parent-document-of-a-subcollection"}),"https://stackoverflow.com/questions/56219469/firestore-get-the-parent-document-of-a-subcollection")))}l.isMDXComponent=!0},211:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return f}));var s=r(0),o=r.n(s);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t){if(null==e)return{};var r,s,o=function(e,t){if(null==e)return{};var r,s,o={},i=Object.keys(e);for(s=0;s<i.length;s++)r=i[s],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)r=i[s],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=o.a.createContext({}),u=function(e){var t=o.a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):n(n({},t),e)),r},d=function(e){var t=u(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},b=o.a.forwardRef((function(e,t){var r=e.components,s=e.mdxType,i=e.originalType,a=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),d=u(r),b=s,f=d["".concat(a,".").concat(b)]||d[b]||p[b]||i;return r?o.a.createElement(f,n(n({ref:t},l),{},{components:r})):o.a.createElement(f,n({ref:t},l))}));function f(e,t){var r=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var i=r.length,a=new Array(i);a[0]=b;var n={};for(var c in t)hasOwnProperty.call(t,c)&&(n[c]=t[c]);n.originalType=e,n.mdxType="string"==typeof e?e:s,a[1]=n;for(var l=2;l<i;l++)a[l]=r[l];return o.a.createElement.apply(null,a)}return o.a.createElement.apply(null,r)}b.displayName="MDXCreateElement"}}]);