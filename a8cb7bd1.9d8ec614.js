(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{152:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return o})),r.d(t,"metadata",(function(){return s})),r.d(t,"rightToc",(function(){return i})),r.d(t,"default",(function(){return l}));var a=r(2),n=(r(0),r(211));const o={title:"Step16 Create User in Firestore"},s={unversionedId:"flutter-crud2a/create-user-in-firestore",id:"flutter-crud2a/create-user-in-firestore",isDocsHomePage:!1,title:"Step16 Create User in Firestore",description:"Goal of this step",source:"@site/docs/flutter-crud2a/create-user-in-firestore.md",permalink:"/docs/flutter-crud2a/create-user-in-firestore",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/flutter-crud2a/create-user-in-firestore.md",sidebar:"flutterCrud2a",previous:{title:"Step15 Recap the flow of state management",permalink:"/docs/flutter-crud2a/recap-the-flow-of-state-management"},next:{title:"Step17 Create Post",permalink:"/docs/flutter-crud2a/create-post"}},i=[{value:"Goal of this step",id:"goal-of-this-step",children:[]},{value:"Why?",id:"why",children:[]},{value:"Install Firestore package",id:"install-firestore-package",children:[]},{value:"Make firestore database",id:"make-firestore-database",children:[]},{value:"Add Firestore code",id:"add-firestore-code",children:[]},{value:"Check the meaning of code",id:"check-the-meaning-of-code",children:[]},{value:"Test it.",id:"test-it",children:[]},{value:"Memo of Error in this step",id:"memo-of-error-in-this-step",children:[]}],c={rightToc:i};function l({components:e,...t}){return Object(n.b)("wrapper",Object(a.a)({},c,t,{components:e,mdxType:"MDXLayout"}),Object(n.b)("h2",{id:"goal-of-this-step"},"Goal of this step"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Create user data in firestore.")),Object(n.b)("h2",{id:"why"},"Why?"),Object(n.b)("p",null,"Why do we need to create firestore user? Is firebase authentication user not enough?"),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},"Firebase auth stores information only ",Object(n.b)("strong",{parentName:"li"},"about authentication"),"."),Object(n.b)("li",{parentName:"ol"},"We want to store data like ",Object(n.b)("strong",{parentName:"li"},"name"),", ",Object(n.b)("strong",{parentName:"li"},"updatedAt")," etc..."),Object(n.b)("li",{parentName:"ol"},"We ",Object(n.b)("strong",{parentName:"li"},"want to store relationship")," with ",Object(n.b)("strong",{parentName:"li"},"User")," and ",Object(n.b)("strong",{parentName:"li"},"Post")," in firestore in a later step.")),Object(n.b)("h2",{id:"install-firestore-package"},"Install Firestore package"),Object(n.b)("p",null,Object(n.b)("a",Object(a.a)({parentName:"p"},{href:"https://pub.dev/packages/cloud_firestore"}),"https://pub.dev/packages/cloud_firestore")),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"*NOTE!"),"\nPlease use this or above version. => Important new feature ",Object(n.b)("inlineCode",{parentName:"p"},"collectionGroup")," added."),Object(n.b)("pre",null,Object(n.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"cloud_firestore: ^0.13.0+1\n")),Object(n.b)("h2",{id:"make-firestore-database"},"Make firestore database"),Object(n.b)("p",null,"Visit: ",Object(n.b)("a",Object(a.a)({parentName:"p"},{href:"https://console.firebase.google.com"}),"https://console.firebase.google.com")),Object(n.b)("p",null,"And make firestore database in ",Object(n.b)("strong",{parentName:"p"},'"test mode"'),"."),Object(n.b)("p",null,Object(n.b)("img",Object(a.a)({parentName:"p"},{src:"https://storage.googleapis.com/coderhackers-assets/flutter_firebase_firestore_crud2a/create-firestore-database.png",alt:"ss"}))),Object(n.b)("h2",{id:"add-firestore-code"},"Add Firestore code"),Object(n.b)("pre",null,Object(n.b)("code",Object(a.a)({parentName:"pre"},{className:"language-dart",metastring:'{11-20} title="lib/pages/register_page.dart"',"{11-20}":!0,title:'"lib/pages/register_page.dart"'}),'onPressed: () async {\n    if (_registerFormKey.currentState.validate()) {\n        try {\n            // Register user by firebase auth\n            final FirebaseUser user = (await FirebaseAuth.instance\n                .createUserWithEmailAndPassword(\n                    email: _emailController.text,\n                    password: _passwordController.text\n                )).user;\n            \n            /* store users data in firestore database */\n            await Firestore.instance\n                .collection("users")\n                .document(user.uid)\n                .setData({\n                    "name": _nameController.text,\n                    "email": _emailController.text,\n                    "createdAt": FieldValue.serverTimestamp(), // https://stackoverflow.com/questions/50907151/flutter-firestore-server-side-timestamp\n                    "updatedAt": FieldValue.serverTimestamp()\n                });\n\n            Navigator.pushNamed(context, \'/\');\n        } catch (e) {\n            print(\'Error Happened!!!: $e\');\n        }  \n    }\n},\n')),Object(n.b)("h2",{id:"check-the-meaning-of-code"},"Check the meaning of code"),Object(n.b)("p",null,"Let's first check the official example code.\n",Object(n.b)("a",Object(a.a)({parentName:"p"},{href:"https://pub.dev/packages/cloud_firestore#usage"}),"https://pub.dev/packages/cloud_firestore#usage")),Object(n.b)("p",null,"This is a code to make a new book."),Object(n.b)("pre",null,Object(n.b)("code",Object(a.a)({parentName:"pre"},{className:"language-dart"}),"Firestore.instance.collection('books').document()\n  .setData({ 'title': 'title', 'author': 'author' });\n")),Object(n.b)("p",null,"If you don't set ",Object(n.b)("inlineCode",{parentName:"p"},"document()")," id blank, firestore automatically create ",Object(n.b)("strong",{parentName:"p"},"documentID")," for you."),Object(n.b)("p",null,"But, in our example, I set the ",Object(n.b)("strong",{parentName:"p"},"user documentID")," equal to the ",Object(n.b)("strong",{parentName:"p"},"Firebase Auth user id"),"."),Object(n.b)("p",null,"By doing this, It will be easy to fetch information related to the current logged-in user."),Object(n.b)("pre",null,Object(n.b)("code",Object(a.a)({parentName:"pre"},{className:"language-dart",metastring:"{3}","{3}":!0}),'Firestore.instance\n    .collection("users")\n    .document(user.uid)\n    .setData({\n        "name": _nameController.text,\n        "email": _emailController.text,\n        "createdAt": FieldValue.serverTimestamp(), // https://stackoverflow.com/questions/50907151/flutter-firestore-server-side-timestamp\n        "updatedAt": FieldValue.serverTimestamp()\n    });\n')),Object(n.b)("h2",{id:"test-it"},"Test it."),Object(n.b)("p",null,"Please register new test user from Flutter App."),Object(n.b)("p",null,"Then, Check it in console: ",Object(n.b)("a",Object(a.a)({parentName:"p"},{href:"https://console.firebase.google.com"}),"https://console.firebase.google.com")),Object(n.b)("h2",{id:"memo-of-error-in-this-step"},"Memo of Error in this step"),Object(n.b)("h4",{id:"debug-console"},Object(n.b)("inlineCode",{parentName:"h4"},"debug console")),Object(n.b)("pre",null,Object(n.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"Error Happened!!!: MissingPluginException(No implementation found for method DocumentReference#setData on channel plugins.flutter.io/cloud_firestore)\n")),Object(n.b)("p",null,"=> ",Object(n.b)("inlineCode",{parentName:"p"},"flutter clean"),"\n",Object(n.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/flutter/flutter/issues/13971"}),"https://github.com/flutter/flutter/issues/13971")),Object(n.b)("p",null,"d8 error:\n",Object(n.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/flutter/flutter/issues/20747"}),"https://github.com/flutter/flutter/issues/20747")))}l.isMDXComponent=!0},211:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return m}));var a=r(0),n=r.n(a);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=n.a.createContext({}),u=function(e){var t=n.a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=u(e.components);return n.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},d=n.a.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=u(r),d=a,m=p["".concat(s,".").concat(d)]||p[d]||b[d]||o;return r?n.a.createElement(m,i(i({ref:t},l),{},{components:r})):n.a.createElement(m,i({ref:t},l))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,s=new Array(o);s[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var l=2;l<o;l++)s[l]=r[l];return n.a.createElement.apply(null,s)}return n.a.createElement.apply(null,r)}d.displayName="MDXCreateElement"}}]);