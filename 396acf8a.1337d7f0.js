(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{211:function(t,e,n){"use strict";n.d(e,"a",(function(){return p})),n.d(e,"b",(function(){return b}));var r=n(0),o=n.n(r);function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},a=Object.keys(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var c=o.a.createContext({}),d=function(t){var e=o.a.useContext(c),n=e;return t&&(n="function"==typeof t?t(e):l(l({},e),t)),n},p=function(t){var e=d(t.components);return o.a.createElement(c.Provider,{value:e},t.children)},u={inlineCode:"code",wrapper:function(t){var e=t.children;return o.a.createElement(o.a.Fragment,{},e)}},f=o.a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,a=t.originalType,i=t.parentName,c=s(t,["components","mdxType","originalType","parentName"]),p=d(n),f=r,b=p["".concat(i,".").concat(f)]||p[f]||u[f]||a;return n?o.a.createElement(b,l(l({ref:e},c),{},{components:n})):o.a.createElement(b,l({ref:e},c))}));function b(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var a=n.length,i=new Array(a);i[0]=f;var l={};for(var s in e)hasOwnProperty.call(e,s)&&(l[s]=e[s]);l.originalType=t,l.mdxType="string"==typeof t?t:r,i[1]=l;for(var c=2;c<a;c++)i[c]=n[c];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}f.displayName="MDXCreateElement"},92:function(t,e,n){"use strict";n.r(e),n.d(e,"frontMatter",(function(){return a})),n.d(e,"metadata",(function(){return i})),n.d(e,"rightToc",(function(){return l})),n.d(e,"default",(function(){return c}));var r=n(2),o=(n(0),n(211));const a={title:"Step22 Edit Post Page"},i={unversionedId:"flutter-crud2a/edit-post-page",id:"flutter-crud2a/edit-post-page",isDocsHomePage:!1,title:"Step22 Edit Post Page",description:"Goal of this chapter",source:"@site/docs/flutter-crud2a/edit-post-page.md",permalink:"/docs/flutter-crud2a/edit-post-page",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/flutter-crud2a/edit-post-page.md",sidebar:"flutterCrud2a",previous:{title:"Step21 Delete Post",permalink:"/docs/flutter-crud2a/delete-post"},next:{title:"Step23 Firestore security rules",permalink:"/docs/flutter-crud2a/firestore-security-rules"}},l=[{value:"Goal of this chapter",id:"goal-of-this-chapter",children:[]},{value:"Add Navigation to PostsEditPage",id:"add-navigation-to-postseditpage",children:[]},{value:"Edit PostsEditPage",id:"edit-postseditpage",children:[]},{value:"Important part of this code",id:"important-part-of-this-code",children:[]}],s={rightToc:l};function c({components:t,...e}){return Object(o.b)("wrapper",Object(r.a)({},s,e,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"goal-of-this-chapter"},"Goal of this chapter"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Edit Post Edit Page")),Object(o.b)("h2",{id:"add-navigation-to-postseditpage"},"Add Navigation to PostsEditPage"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-dart",metastring:'title="lib/pages/my_posts_page.dart"',title:'"lib/pages/my_posts_page.dart"'}),"case 'edit':\n    Navigator.push(\n        context,\n        MaterialPageRoute(\n            builder: (context) => PostsEditPage(post: post),\n        ),\n    );\n    break;\n")),Object(o.b)("h2",{id:"edit-postseditpage"},"Edit PostsEditPage"),Object(o.b)("p",null,"This code is almost same with Post New Page. I will explain the difference later."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-dart",metastring:'title="lib/pages/posts_edit_page.dart"',title:'"lib/pages/posts_edit_page.dart"'}),"import 'package:cloud_firestore/cloud_firestore.dart';\nimport 'package:flutter/material.dart';\nimport 'package:firebase_auth/firebase_auth.dart';\nimport 'package:flutter_firebase_firestore_crud2a/models/post.dart';\nimport 'package:provider/provider.dart';\n\nclass PostsEditPage extends StatefulWidget {\n  PostsEditPage({Key key, @required this.post}) : super(key: key);\n  final Post post;\n\n  @override\n  _PostsEditPageState createState() => _PostsEditPageState();\n}\n\nclass _PostsEditPageState extends State<PostsEditPage> {\n  final GlobalKey<FormState> _editPostFormKey_ = GlobalKey<FormState>();\n  final titleInputController = TextEditingController();\n  final contentInputController = TextEditingController();\n\n  // https://flutter.dev/docs/development/ui/interactive\n  bool _isSubmitting = false;\n\n  @override\n  initState() {\n    // https://github.com/flutter/flutter/issues/9969\n    titleInputController.text = widget.post.title;\n    contentInputController.text = widget.post.content;\n    super.initState();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n        appBar: AppBar(\n          title: Text(\"Edit Post\"),\n        ),\n        body: Container(\n          padding: const EdgeInsets.all(20.0),\n          child: SingleChildScrollView(\n            child: Form(\n            key: _editPostFormKey_,\n            child: Column(\n              children: <Widget>[\n                TextFormField(\n                  decoration: InputDecoration(\n                      labelText: 'Title*', hintText: \"Title\"),\n                  controller: titleInputController,\n                  validator: (value) {\n                    if (value.isEmpty) {\n                      return \"Please enter a title.\";\n                    }\n                    return null;\n                  },\n                ),\n                TextFormField(\n                  decoration: InputDecoration(\n                      labelText: 'Content', hintText: \"Post content here...\"),\n                  controller: contentInputController,\n                ),\n                SizedBox(height: 20),\n                _isSubmitting ? // https://stackoverflow.com/questions/47065098/how-to-work-with-progress-indicator-in-flutter\n                Center(child: CircularProgressIndicator())\n                :\n                RaisedButton(\n                  child: Text(\"Update Post\"),\n                  color: Theme.of(context).primaryColor,\n                  textColor: Colors.white,\n                  onPressed: () async {\n                    if (_editPostFormKey_.currentState.validate()) {\n                      try {\n                        setState(() {\n                          _isSubmitting = true;\n                        });\n                        \n                        final user = Provider.of<FirebaseUser>(context, listen: false);\n                      \n                        await Firestore.instance\n                          .collection('users')\n                          .document(user.uid)\n                          .collection(\"posts\")\n                          .document(widget.post.id)\n                          .updateData({\n                            \"title\": titleInputController.text,\n                            \"content\": contentInputController.text,\n                                                        \"updatedAt\": FieldValue.serverTimestamp()\n                          });\n                        \n                        Navigator.pop(context);\n                      } catch (e) {\n                        print('Error Happened!!!: $e');\n                        setState(() {\n                          _isSubmitting = false;\n                        });\n                      }  \n                    }\n                  },\n                ),\n              ],\n            ),\n          )\n        )\n      )\n    );\n  }\n}\n")),Object(o.b)("h2",{id:"important-part-of-this-code"},"Important part of this code"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Set initial form value by using passed props.")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-dart"}),"initState() {\n    // https://github.com/flutter/flutter/issues/9969\n    titleInputController.text = widget.post.title;\n    contentInputController.text = widget.post.content;\n    super.initState();\n}\n")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Update firestore request.\n",Object(o.b)("a",Object(r.a)({parentName:"li"},{href:"https://pub.dev/documentation/cloud_firestore/latest/cloud_firestore/DocumentReference-class.html"}),"https://pub.dev/documentation/cloud_firestore/latest/cloud_firestore/DocumentReference-class.html"))),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-dart"}),'await Firestore.instance\n    .collection(\'users\')\n    .document(user.uid)\n    .collection("posts")\n    .document(widget.post.id)\n    .updateData({\n        "title": titleInputController.text,\n        "content": contentInputController.text,\n        "updatedAt": FieldValue.serverTimestamp()\n    });\n')))}c.isMDXComponent=!0}}]);